import e from"react";import{EditorState as t,CharacterMetadata as n,Modifier as o,SelectionState as l,AtomicBlockUtils as r,RichUtils as a,convertToRaw as i,Editor as s,DefaultDraftBlockRenderMap as c}from"draft-js";import p,{OrderedSet as d,Map as u}from"immutable";import f from"lodash";import h from"classnames";class g{constructor(){this.events={},this.finishs=[]}on(e,...t){this.events[e]=this.events[e]||[],this.events[e].push(...t)}onOne(e,...t){const n="one-"+e;this.events[n]=[...t]}fireFinish(e){this.finishs.push(e)}working(e,t,n){const o="function"==typeof n&&n(...t);this.finishs.forEach((n=>"function"==typeof n&&n(e,t,o)))}fire(e,...t){const n=Object.keys(this.events);(n.includes(e)||n.includes("one-"+e))&&(n.includes("one-"+e)&&this.events["one-"+e].forEach((n=>this.working(e,t,n))),this.events[e].forEach((n=>this.working(e,t,n))))}}class y{constructor(e,t){this.stack=[],this.cursor=0,this.top=0,this.bottom=0,this.length=0,this.length=e,t&&this.stack.push(t)}undo(){if(!this.isBottom()){const e=(this.cursor-1+this.length)%this.length;return this.cursor=e,this.stack[this.cursor]}}redo(){if(!this.isTop()){const e=(this.cursor+1)%this.length;return this.cursor=e,this.stack[this.cursor]}}push(e){const t=(this.cursor+1)%this.length;this.top=this.cursor=t,this.stack[this.cursor]=e,t===this.bottom&&(this.bottom=(t+1)%this.length)}isTop(){return this.top===this.cursor}isBottom(){return this.bottom===this.cursor}}const m=(e,n)=>{let l=[];const r=e.getCurrentContent(),a=e.getSelection(),i=a.getStartKey(),s=a.getEndKey();let c="";for(;c!==s&&void 0!==c;){c=r.getKeyAfter(c||i)||i;r.getBlockForKey(c||i).getCharacterList().forEach((e=>{l.push(...e.getStyle().toJS())}))}l=[...new Set(l)];let p=r;return l.forEach((e=>p=n.test(e)?o.removeInlineStyle(p,a,e):p)),t.push(e,p,"change-inline-style")},b=t=>e.createElement(e.Fragment,null,e.Children.map(t.children,((t,o)=>{const l=f.get(t,"props.children",{}),r=f.get(l,"props.block",{}).data.toJS()||{};if(["h1","h2","h3","h4","h5","h6"].includes(t.type)){const a=e.Children.map(l,((t,o)=>{const l=((e,t)=>{const o=e.getCharacterList().map((e=>{const o=e.getStyle();let l=e;return o.forEach((o=>{e&&o&&t.test(o)&&(l=n.removeStyle(l,o))})),l}));return e.set("characterList",o)})(f.get(t,"props.block",{}),/^\d{1,2}px$/);return e.cloneElement(t,{block:l})}));return e.cloneElement(t,{style:r,key:o,children:a})}return e.cloneElement(t,{style:r,key:o})})));function _(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],l=document.createElement("style");l.type="text/css","top"===n&&o.firstChild?o.insertBefore(l,o.firstChild):o.appendChild(l),l.styleSheet?l.styleSheet.cssText=e:l.appendChild(document.createTextNode(e))}}var x="style_iconfont__1YWrI";_('.style_iconfont__1YWrI {\n  font-family: "iconfont" !important;\n  font-size: 16px;\n  font-style: normal;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n');const v=t=>{const{fontIcon:n}=t;return e.createElement("span",{className:x,dangerouslySetInnerHTML:{__html:""+n}})},E=p.Map({unstyled:{element:"div",wrapper:e.createElement("div",null),aliasedElements:["p"]},"header-one":{element:"h1",wrapper:e.createElement(b,null)},"header-two":{element:"h2",wrapper:e.createElement(b,null)},"header-three":{element:"h3",wrapper:e.createElement(b,null)},"header-four":{element:"h4",wrapper:e.createElement(b,null)},"header-five":{element:"h5",wrapper:e.createElement(b,null)},"header-six":{element:"h6",wrapper:e.createElement(b,null)}}),k=[{value:["#000000","#262626","#595959","#8c8c8c","#bfbfbf","#d9d9d9","#e9e9e9","#f5f5f5","#fafafa","#ffffff"]},{value:["#f5222d","#fa541c","#fa8c16","#fadb14","#52c41a","#13c2c2","#1890ff","#2f54eb","#722ed1","#eb2f96"]},{value:["#ffe8e6","#ffece0","#ffefd1","#fff8bd","#e4f7d2","#d3f5f0","#d4eefc","#dee8fc","#efe1fa","#fae1eb"]},{value:["#ffa39e","#ffbb96","#ffd591","#fff08f","#b7eb8f","#87e8de","#91d5ff","#adc6ff","#d3adf7","#ffadd2"]},{value:["#ff4d4f","#ff7a45","#ffa940","#ffec3d","#73d13d","#36cfc9","#40a9ff","#127ef7","#9254de","#f759ab"]},{value:["#cf1322","#d4380d","#d46b08","#d4b106","#389e0d","#08979c","#096dd9","#1d39c4","#531dab","#c41d7f"]},{value:["#820014","#871400","#873800","#614700","#135200","#00474f","#003a8c","#061178","#22075e","#780650"]}],S=[{action:"changeEditorState",type:"btn",areas:[{lable:"保存",icon:e.createElement(v,{fontIcon:""}),value:"seve"},{lable:"撤销",icon:e.createElement(v,{fontIcon:""}),value:"undo"},{lable:"重做",icon:e.createElement(v,{fontIcon:""}),value:"redo"}]},{action:"format",type:"btn",areas:[{lable:"格式刷",icon:e.createElement(v,{fontIcon:""}),value:"applyStyle"},{lable:"清除格式",icon:e.createElement(v,{fontIcon:""}),value:"clearStyle"}]},[{action:"toggleBlockType",type:"select",initValue:"unstyled",lable:"文本和标题",areas:[{lable:'<div style="margin: 0; display: inline-block; min-width: 120px;">正文</div>',value:"unstyled"},{lable:'<h1 style="margin: 0; display: inline-block; min-width: 120px;">标题 1</h1>',value:"header-one"},{lable:'<h2 style="margin: 0; display: inline-block; min-width: 120px;">标题 2</h2>',value:"header-two"},{lable:'<h3 style="margin: 0; display: inline-block; min-width: 120px;">标题 3</h3>',value:"header-three"},{lable:'<h4 style="margin: 0; display: inline-block; min-width: 120px;">标题 4</h4>',value:"header-four"},{lable:'<h5 style="margin: 0; display: inline-block; min-width: 120px;">标题 5</h4>',value:"header-five"},{lable:'<h6 style="margin: 0; display: inline-block; min-width: 120px;">标题 6</h4>',value:"header-six"}]},{action:"toggleInlineStyle",type:"select",initValue:"12px",lable:"字号",areas:[{lable:"12px",value:"12px"},{lable:"13px",value:"13px"},{lable:"14px",value:"14px"},{lable:"15px",value:"15px"},{lable:"16px",value:"16px"},{lable:"19px",value:"19px"},{lable:"22px",value:"22px"},{lable:"24px",value:"24px"},{lable:"29px",value:"29px"},{lable:"32px",value:"32px"},{lable:"40px",value:"40px"},{lable:"48px",value:"48px"}]}],{action:"toggleInlineStyle",type:"btn",areas:[{lable:"加粗",icon:e.createElement(v,{fontIcon:""}),value:"BOLD"},{lable:"斜体",icon:e.createElement(v,{fontIcon:""}),value:"ITALIC"},{lable:"删除线",icon:e.createElement(v,{fontIcon:""}),value:"STRIKETHROUGH"},{lable:"下划线",icon:e.createElement(v,{fontIcon:""}),value:"UNDERLINE"},{lable:"更多文本样式",icon:e.createElement(v,{fontIcon:""}),value:"dd"}]},[{action:"toggleInlineStyle",type:"color",initValue:"#000000",lable:"字体颜色",icon:e.createElement(v,{fontIcon:""}),areas:k},{action:"toggleInlineStyle",type:"background",initValue:"#ffffff",lable:"背景色",icon:e.createElement(v,{fontIcon:""}),areas:k}],{action:"addBlockType",type:"select",initValue:JSON.stringify({textAlign:"left"}),lable:"对齐方式",areas:[{lable:"左对齐",icon:e.createElement(v,{fontIcon:""}),value:JSON.stringify({textAlign:"left"})},{lable:"居中对齐",icon:e.createElement(v,{fontIcon:""}),value:JSON.stringify({textAlign:"center"})},{lable:"右对齐",icon:e.createElement(v,{fontIcon:""}),value:JSON.stringify({textAlign:"right"})}]},{action:"addEntity",type:"popover",initValue:JSON.stringify({textAlign:"left"}),areas:[{lable:"插入图片",icon:e.createElement(v,{fontIcon:""}),value:"image"},{lable:"插入表格",icon:e.createElement(v,{fontIcon:""}),value:JSON.stringify({textAlign:"center"})},{lable:"插入公示",icon:e.createElement(v,{fontIcon:""}),value:JSON.stringify({textAlign:"right"})}]}],w={"12px":{fontSize:"12px"},"13px":{fontSize:"13px"},"14px":{fontSize:"14px"},"15px":{fontSize:"15px"},"16px":{fontSize:"16px"},"19px":{fontSize:"19px"},"22px":{fontSize:"22px"},"24px":{fontSize:"24px"},"29px":{fontSize:"29px"},"32px":{fontSize:"32px"},"40px":{fontSize:"40px"},"48px":{fontSize:"48px"}};k.forEach((({value:e})=>{e.forEach((e=>{w["color-"+e]={color:e},w["background-"+e]={background:e}}))}));var C="style_page__2FnF3",A="style_main__3Jxot",I="style_editor__1Eryk";_(".style_page__2FnF3 {\n  display: flex;\n  height: 100%;\n  overflow: hidden;\n  flex-direction: column;\n  align-items: center;\n  position: relative;\n  background-color: #f9f9f9;\n}\n.style_page__2FnF3 .style_main__3Jxot {\n  width: 100%;\n  overflow-y: auto;\n  padding-bottom: 64px;\n}\n.style_page__2FnF3 .style_main__3Jxot .style_editor__1Eryk {\n  border: 1px solid #e8e8e8;\n  border-radius: 3px;\n  box-shadow: 0 2px 8px rgba(115, 115, 115, 0.08);\n  width: 872px;\n  min-height: 1455px;\n  margin: 16px auto 0 auto;\n  padding: 20px 60px 90px 60px;\n  background-color: white;\n}\n");var N=e.forwardRef(((n,p)=>{"function"==typeof p&&p((e=>p=e));const{editorState:g,setEditorState:y,onChange:b,event:_,stack:x,plugins:v}=n,[k,S]=e.useState(!1),C=e.useRef(g);e.useEffect((()=>{C.current=g}),[g]);const A=()=>C.current,[N,T]=e.useState({});e.useEffect((()=>{const e={},t={},n={getCurrentStart:A,setEditorState:y,event:_,editorRef:p};v.forEach((e=>{const o="function"==typeof e&&e(n);f.keys(o).forEach((e=>{/.*Fn$|^handle.*/.test(e)&&(t[e]||(t[e]=[]),t[e].push(o[e]))}))})),f.keys(t).forEach((n=>{e[n]=((e,t)=>(...n)=>{if("blockRendererFn"===e){let e={props:{}};return t.forEach((t=>{const o="function"==typeof t?t(...n):void 0;if(null!=o){const{props:t,...n}=o,{props:l,...r}=e;e={...r,...n,props:{...l,...t}}}})),!!e.component&&e}if("blockStyleFn"===e){let o;return t.forEach((t=>{const l="function"==typeof t[e]?t[e](...n):void 0;null!=l&&(o=(o?o+" ":"")+l)})),o||""}if("handleKeyCommand"===e)return t.some((e=>"function"==typeof e&&"handled"===e(...n)))?"handled":"not-handled";let o;return!!t.some((t=>(o="function"==typeof t[e]?t[e](...n):void 0,void 0!==o)))&&o})(n,t[n])})),T(e)}),[]),e.useEffect((()=>{_.on("toggleInlineStyle",(e=>{const n=A().getSelection();if(n.getEndOffset()-n.getStartOffset()==0){const n=((e,n="‎",r)=>{const a=e.getCurrentInlineStyle().toJS(),i=e.getCurrentContent(),s=e.getSelection();let c=d(a);r.forEach((e=>c=c.has(e)?c.delete(e):c.add(e)));const p=o.insertText(i,s,n,c);let u=t.createWithContent(p);const f=s.getAnchorKey(),h=s.getFocusOffset()+n.length,g=new l({anchorKey:f,anchorOffset:h,focusKey:f,focusOffset:h});return u=t.acceptSelection(u,g),u})(A(),"‎",[e]);return y(n),setTimeout((()=>{p.current&&p.current.focus()})),n}const r=a.toggleInlineStyle(A(),e);return y(r),r})),_.on("toggleBlockType",(e=>{const t=a.toggleBlockType(A(),e);return y(t),t})),_.on("addBlockType",(e=>{const n=A().getCurrentContent(),l=A().getSelection(),r=u(JSON.parse(e)),a=o.mergeBlockData(n,l,r);let i=t.createWithContent(a);return i=t.acceptSelection(i,l),y(i),i})),_.on("format",(e=>{if("clearStyle"===e){const e=m(A(),/.*/);return y(e),e}"applyStyle"===e&&S(!0)})),_.on("addEntity",(e=>{const n=((e,n,o)=>{const l=o.toLocaleUpperCase(),a=e.getCurrentContent().createEntity(l,"IMMUTABLE",{src:n}).getLastCreatedEntityKey();let i=r.insertAtomicBlock(e,a,"add-"+o);const s=i.getCurrentContent(),c=s.getBlockMap(),p=c.find((e=>e.getEntityAt(0)===a)),d=s.getBlockBefore(p.getKey());if(d&&""===d.getText()){const e=c.filter((e=>e.getKey()!==d.getKey())),n=s.set("blockMap",e);i=t.createWithContent(n)}return t.forceSelection(i,i.getCurrentContent().getSelectionAfter())})(A(),e,"IMAGE");return y(n),n})),_.on("changeEditorState",(e=>{if("undo"===e){const e=x.undo();e&&y(e)}else if("redo"===e){const e=x.redo();e&&y(e)}else if("seve"===e){const e=A().getCurrentContent();i(e)}})),_.fireFinish(((e,t,n)=>{!["changeEditorState"].includes(e)&&n&&x.push(n)}))}),[]);return e.createElement("div",{className:h({formatBrush:k},I),onClick:e=>{"true"!==document.activeElement.contentEditable&&setTimeout((()=>{p.current&&p.current.focus()}))}},e.createElement(s,Object.assign({customStyleMap:w,blockRenderMap:c.merge(E)},N,{editorState:g,onChange:e=>{const n=g.getCurrentContent().getPlainText();if(e.getCurrentContent().getPlainText()!==n&&("function"==typeof b&&b(e),x.push(e)),k){const n=((e,n)=>{const l=m(e,/.*/),r=l.getCurrentContent(),a=l.getSelection();let i=r;return n.forEach((e=>i=o.applyInlineStyle(i,a,e))),t.push(l,i,"change-inline-style")})(e,g.getCurrentInlineStyle().toJS());return S(!1),void y(n)}y(e)},ref:p})))}));const T=e.createContext({});var O="style_select__Os_gC",B="style_lake__8HnBa",F="style_dropDown__ZSRCu",K="style_option__g9LRZ";_(".style_select__Os_gC {\n  position: relative;\n  display: inline-block;\n  outline: none;\n}\n.style_select__Os_gC .style_lake__8HnBa {\n  display: inline-block;\n  height: 100%;\n  padding-right: 20px;\n  white-space: nowrap;\n}\n.style_select__Os_gC .style_lake__8HnBa > i {\n  position: relative;\n}\n.style_select__Os_gC .style_lake__8HnBa > i:after {\n  display: block;\n  content: '';\n  position: absolute;\n  top: 7px;\n  left: 10px;\n  border-width: 8px 5px 8px 5px;\n  border-style: solid;\n  border-color: #555 transparent transparent transparent;\n}\n.style_select__Os_gC .style_dropDown__ZSRCu {\n  position: absolute;\n  padding: 5px 0;\n  top: 40px;\n  left: -8px;\n  border: 1px solid #e8e8e8;\n  background-color: white;\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.12);\n  flex-direction: column;\n  justify-content: space-evenly;\n  z-index: 1000;\n}\n.style_select__Os_gC .style_option__g9LRZ {\n  padding: 3px 8px;\n  white-space: nowrap;\n  cursor: pointer;\n}\n.style_select__Os_gC .style_option__g9LRZ:hover {\n  background-color: #f5f5f5;\n}\n");const D=t=>{let{disabled:n,className:o,tooltip:l,children:r,initValue:a,value:i,lable:s,onChange:c,automatic:p=!0}=t;if(!e.Children.count(r))return e.createElement("div",null);let d={};const u=i||a;u&&(d=r.find((({props:e})=>e.value===u))||{});const[f,h]=e.useState(!1),[g,y]=e.useState(d.props||{}),m=e.useRef(null);e.useEffect((()=>{const e=e=>{let t=e.target;for(;t&&"BODY"!==t.nodeName;){if(t===m.current){e.preventDefault();break}t=t.parentElement}if(!t||"BODY"===t.nodeName)return e.preventDefault(),void h(!1)};return document.querySelector("body")&&document.querySelector("body").addEventListener("click",e,!1),()=>{document.querySelector("body")&&document.querySelector("body").removeEventListener("click",e)}}),[]),e.useEffect((()=>{i&&(d=r.find((({props:e})=>e.value===i)),d&&y(d.props))}),[i]);const b={v:u||g.value,setV:e=>{const t=r.find((({props:t})=>t.value===e))||{};y(t.props||{value:e}),"function"==typeof c&&c(e),p&&h(!1)}};return e.createElement("div",{ref:e=>m.current=e,className:O,disabled:n},e.createElement("div",{className:o,tooltip:l,onMouseDown:e=>{e.preventDefault(),h(!n&&!f)}},e.createElement("span",{className:B},s||g.lable||g.value||u,e.createElement("i",null))),e.createElement(T.Provider,{value:b},e.createElement("div",{className:F,style:{display:""+(f?"inline-flex":"none")}},r)))};D.Option=t=>{const{value:n,children:o,lable:l,className:r,style:a}=t;let i=o;return o||(i=e.createElement("div",null,l)),e.createElement(T.Consumer,null,(({v:t,setV:o})=>e.createElement("div",{className:`${K} ${r}`,style:a},"function"==typeof i?e.createElement("div",null,i(t,o)):e.createElement("div",{onMouseDown:e=>{e.preventDefault(),o(n)}},i))))};var R="style_popover__2RxA8",L="style_dropDown__2LkP4";_(".style_popover__2RxA8 {\n  position: relative;\n}\n.style_popover__2RxA8 .style_btn__1-e3m {\n  padding: 0;\n  margin: 0;\n  border: none;\n  outline: none;\n  background-color: transparent;\n}\n.style_popover__2RxA8 .style_dropDown__2LkP4 {\n  cursor: auto;\n  padding: 5px 10px;\n  position: absolute;\n  top: 40px;\n  left: -8px;\n  border: 1px solid #e8e8e8;\n  background-color: white;\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.12);\n  flex-direction: column;\n  justify-content: space-evenly;\n  z-index: 1000;\n}\n");const z=t=>{const{className:n,lable:o,icon:l,children:r,disabled:a=!1,tooltip:i}=t,s=e.useRef(null),[c,p]=e.useState(!1);return e.useEffect((()=>{const e=e=>{let t=e.target;for(;t&&"BODY"!==t.nodeName;){if(t===s.current)return void e.preventDefault();t=t.parentElement}if(!t||"BODY"===t.nodeName)return e.preventDefault(),void p(!1)};return document.querySelector("body")&&document.querySelector("body").addEventListener("click",e,!1),()=>{document.querySelector("body")&&document.querySelector("body").removeEventListener("click",e)}}),[]),e.createElement("div",{ref:e=>s.current=e,className:h(n,R,{tooltip:!a&&!c}),disabled:a,tooltip:i,onMouseDown:e=>{e.stopPropagation(),p(!a&&!c)}},l,e.createElement("div",{className:L,style:{display:""+(c?"inline-flex":"none")},onMouseDown:e=>{e.stopPropagation()}},r))};var q="style_lable__2qU9T",Y="style_option__YhK-o",J="style_colorItem__3Fi51";_(".style_lable__2qU9T {\n  display: inline-block;\n}\n.style_lable__2qU9T > em {\n  display: block;\n  width: 16px;\n  height: 2px;\n}\n.style_option__YhK-o {\n  font-size: 0;\n}\n.style_option__YhK-o:hover {\n  cursor: auto;\n  background-color: transparent !important;\n}\n.style_option__YhK-o .style_colorItem__3Fi51 {\n  position: relative;\n  display: inline-block;\n  width: 25px;\n  height: 25px;\n  margin: 0 4px;\n  padding: 1px;\n  border-radius: 3px;\n  border: 1px solid transparent;\n}\n.style_option__YhK-o .style_colorItem__3Fi51:hover {\n  border-color: #fa541c;\n}\n.style_option__YhK-o .style_colorItem__3Fi51 span {\n  display: inline-block;\n  margin: 2px;\n  width: 21px;\n  height: 21px;\n  cursor: pointer;\n  border-radius: 3px;\n}\n.style_option__YhK-o .style_colorItem__3Fi51 span + span {\n  position: absolute;\n  color: white;\n  z-index: 99;\n  top: 2px;\n  left: 3px;\n}\n");const M=t=>{const{disabled:n,change:o,areas:l,lable:r,icon:a,value:i,initValue:s="#000000"}=t,c=i||s,[p,d]=e.useState(c);e.useEffect((()=>d(c)),[c]);const u=e.createElement("span",{className:q},a,e.createElement("em",{style:{backgroundColor:p}}));return e.createElement(D,{disabled:n,className:h({tooltip:!n}),initValue:s,value:c,onChange:o,tooltip:r,lable:u},l.map((({value:t},n)=>e.createElement(D.Option,{className:Y,key:n},((o,l)=>t.map(((t,r)=>e.createElement("span",{className:J,key:`${n}-${r}`,onMouseDown:e=>{e.preventDefault(),t!==o&&(l(t),d(t))}},e.createElement("span",{style:{backgroundColor:t}}),o===t?e.createElement(v,{fontIcon:""}):""))))))))};var U="style_input__Ohlyv";_(".style_input__Ohlyv {\n  display: inline-block;\n  color: rgba(0, 0, 0, 0.85);\n  font-size: 14px;\n  padding: 1px 8px;\n  line-height: 1.33;\n  border: 1px solid #d9d9d9;\n  border-radius: 2px;\n  transition: all 0.3s;\n}\n.style_input__Ohlyv:focus {\n  border-color: #40a9ff;\n  border-right-width: 1px!important;\n  outline: 0;\n  box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);\n}\n");var V=e.forwardRef(((t,n)=>{const{className:o,placeholder:l,onChange:r=(()=>{}),onBlur:a=(()=>{}),onFocus:i}=t;return e.createElement("input",{ref:n,className:h(o,U),onChange:r,onBlur:a,onFocus:i,placeholder:l})})),$="style_editorToolbar__3gucq",j="style_barArea__1hKog";_(".style_editorToolbar__3gucq {\n  width: 100%;\n  height: 42px;\n  border: 1px solid #e8e8e8;\n  display: flex;\n  justify-content: center;\n  background-color: white;\n  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);\n  position: sticky;\n  top: 0;\n}\n.style_editorToolbar__3gucq button {\n  background-color: white;\n}\n.style_editorToolbar__3gucq .style_barArea__1hKog {\n  height: 100%;\n  padding: 3px 0;\n  display: inline-block;\n  border-right: 1px solid #e8e8e8;\n  box-sizing: border-box;\n  vertical-align: middle;\n}\n.style_editorToolbar__3gucq .style_barArea__1hKog:nth-child(1) {\n  border-left: 1px solid #e8e8e8;\n}\n.style_editorToolbar__3gucq .style_barArea__1hKog > * {\n  box-sizing: border-box;\n  display: inline-block;\n  height: 100%;\n  font-size: 16px;\n  margin: 0 5px;\n  padding: 5px 11px;\n  border: none;\n  border-radius: 5px;\n  outline: none;\n  cursor: pointer;\n}\n.style_editorToolbar__3gucq .style_barArea__1hKog > *:hover {\n  background-color: #f5f5f5;\n}\n.style_editorToolbar__3gucq .style_barArea__1hKog > *[active='true'] {\n  color: #3cb034;\n  font-weight: bold;\n}\n.style_editorToolbar__3gucq .style_barArea__1hKog > *[disabled] {\n  background-color: transparent;\n  opacity: 0.4;\n  text-shadow: none;\n  box-shadow: none;\n  cursor: not-allowed;\n}\n");const G=t=>{const{event:n,editorState:o,stack:l}=t,r=o.getCurrentInlineStyle().toJS(),a=o.getSelection(),i=o.getCurrentContent().getBlockForKey(a.getStartKey()).getType(),s=o.getCurrentContent().getBlockForKey(a.getStartKey()).getData().toJS(),c=(t,o)=>{let a=!1;const{action:c,type:p,areas:d,initValue:u,lable:g,icon:y}=t;let m=void 0;if("文本和标题"===g)m=i;else if("字号"===g)a=["header-one","header-two","header-three","header-four","header-five","header-six"].includes(i),m=f.findLast(r,(e=>/^\d{1,2}px$/.test(e)))||u;else if("对齐方式"===g)try{const e=f.get(s,"textAlign");m=e?JSON.stringify({textAlign:e}):u}catch(e){}else if("字体颜色"===g){const e=(f.findLast(r,(e=>/^color-#\w{6}$/.test(e)))||"").match(/^color-(#\w{6})$/);m=e?e[1]:u}else if("背景色"===g){const e=(f.findLast(r,(e=>/^background-#\w{6}$/.test(e)))||"").match(/^background-(#\w{6})$/);m=e?e[1]:u}switch(p){case"btn":return d.map(((t,a)=>((t,o,a)=>{const{value:i,lable:s}=t;let c=r.includes(i)?"true":"false",p=!1;return"撤销"===s?(p=l.isBottom(),c=""+!p):"重做"===s&&(p=l.isTop(),c=""+!p),e.createElement("button",{key:a,disabled:p,className:h({tooltip:!p}),active:c,tooltip:s,onMouseDown:e=>{e.preventDefault(),n.fire(""+o,i)}},t.icon)})(t,c,`${o}-${a}`)));case"select":return e.createElement(D,{disabled:a,className:h({tooltip:!a}),key:o,onChange:e=>n.fire(""+c,e),initValue:u,value:m,tooltip:g},d.map((({icon:t,lable:n="",value:l},r)=>e.createElement(D.Option,{key:`${o}-${r}`,value:l,lable:t||e.createElement("span",{style:{width:"45px",display:"inline-block"},dangerouslySetInnerHTML:{__html:n.replace(/<[^>]+>/g,"")}})},((o,r)=>e.createElement("span",{onMouseDown:e=>{e.preventDefault(),l!==o&&r(l)}},t,e.createElement("span",{style:{minWidth:"75px",display:"inline-block",marginLeft:"8px",verticalAlign:"middle"},dangerouslySetInnerHTML:{__html:""+n}}),o===l?e.createElement(v,{fontIcon:""}):""))))));case"color":case"background":return e.createElement(M,{key:o,disabled:a,initValue:u,value:m,change:e=>n.fire(""+c,`${p}-${e}`),areas:d,lable:g,icon:y});case"popover":return d.map((({icon:t,lable:l},r)=>e.createElement(z,{key:`${o}-${r}`,icon:t,tooltip:l},e.createElement(V,{onBlur:e=>{const t=e.target.value;e.target.value="",n.fire(""+c,t)}}))));default:return""}};return e.createElement("div",{className:$},S.map(((t,n)=>e.createElement("div",{className:j,key:n},Array.isArray(t)?t.map(((e,t)=>c(e,`${n}-${t}`))):c(t,n)))))},H=t=>{const{blockProps:{src:n}}=t;return e.createElement("div",{style:{width:"100%"}},e.createElement("img",{style:{width:"100%"},src:n}))};var P=e=>{const{getCurrentStart:t,setEditorState:n,event:o,editorRef:l}=e;return{handleKeyCommand:(e,t)=>{let o;switch(e){case"backspace":o=a.onBackspace(t);break;case"delete":o=a.onDelete(t);break;default:return"not-handled"}return null!=o?(n(o),"handled"):"not-handled"},blockRendererFn:e=>{if("atomic"===e.getType()){const n=t().getCurrentContent(),o=e.getEntityAt(0);if(!o)return null;const l=n.getEntity(o).getType(),r=n.getEntity(o).getData();if("IMAGE"===l||"image"===l){const{src:e}=r||{};return{component:H,editable:!1,props:{src:e}}}return null}return null},blockStyleFn:e=>""}};_("html,\nbody {\n  margin: 0;\n  padding: 0;\n  height: 100%;\n}\nfigure {\n  padding: 0;\n  margin: 0;\n}\n#root {\n  overflow: auto;\n  height: 100%;\n}\n@font-face {\n  font-family: 'iconfont';\n  /* project id 1749590 */\n  src: url('//at.alicdn.com/t/font_1749590_pinxwu32l5l.eot');\n  src: url('//at.alicdn.com/t/font_1749590_pinxwu32l5l.eot?#iefix') format('embedded-opentype'), url('//at.alicdn.com/t/font_1749590_pinxwu32l5l.woff2') format('woff2'), url('//at.alicdn.com/t/font_1749590_pinxwu32l5l.woff') format('woff'), url('//at.alicdn.com/t/font_1749590_pinxwu32l5l.ttf') format('truetype'), url('//at.alicdn.com/t/font_1749590_pinxwu32l5l.svg#iconfont') format('svg');\n}\n/* 编辑器的高度*/\n/*文字选中效果*/\n*::selection {\n  background-color: #e1f0fe;\n  color: inherit;\n}\n*::-moz-selection {\n  background-color: #e1f0fe;\n  color: inherit;\n}\n*::-webkit-selection {\n  background-color: #e1f0fe;\n  color: inherit;\n}\n.formatBrush {\n  cursor: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAUCAYAAACTQC2+AAAABGdBTUEAALGPC/xhBQAAATtJREFUSA3dlTFLA0EQhU+jlSkEG63EYGdlZZFG7QUbSyG/QP/C/Q0rqzQWQX+BwUKwtrexEFRQtFSI35NZWDa3soOHhQ8eM/v2zWw2N9xVVVUdwXUYoFxaq5il2wa8hvtG5dJaxYx16xFvLN8i3lmehiFC6Y94wbsTGsxZosajKA/7aewjrKZiyTocJO9DSYHT82r+YXyQs0eRfYBrD/Y1DB58OMyfeM/hrWq8N9qlZkmFBXiPPd6D7ikWUxwjrKWirTeJkzDeNYttKIxhDUuxiFGjfAnfMkUX3hs19emYqFt9P48mU6zVLEQPFjCfwgk8gyuwEd6pS5t0EQYmHhCXLZ8Kvz1oqmFO+H8HxVOXfZC5vwNd46y3xbx5ni1mQ4+dJ6NyDw4xX0GN9484YfcRhg+fcmmt408+5V99wSyVTWN94gAAAABJRU5ErkJggg==) 5 10, text;\n}\n.tooltip {\n  position: relative;\n}\n.tooltip:hover:after {\n  content: attr(tooltip);\n  white-space: nowrap;\n  position: absolute;\n  top: 45px;\n  left: calc(50% - 17px);\n  background-color: #555;\n  padding: 8px 8px;\n  border-radius: 5px;\n  color: white;\n  font-size: 12px;\n  line-height: 1.5;\n}\n.tooltip:hover:before {\n  display: block;\n  content: '';\n  position: absolute;\n  top: 38px;\n  left: calc(50% - 5px);\n  border-width: 0 5px 8px 5px;\n  border-style: solid;\n  border-color: transparent transparent #555 transparent;\n}\n");export default()=>{const n=t.createEmpty(),[o,l]=e.useState(n),r=e.useRef(null),a=e.useRef(new g),i=e.useRef(new y(100,o)),s={editorState:o,stack:i.current,event:a.current},c={plugins:[P],event:a.current,stack:i.current,editorState:o,setEditorState:l};return e.createElement("div",{className:C},e.createElement(G,Object.assign({},s)),e.createElement("div",{className:A},e.createElement(N,Object.assign({ref:r},c))))};
